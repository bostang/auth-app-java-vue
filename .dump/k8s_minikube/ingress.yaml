# k8s/ingress.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: auth-app-ingress
  # namespace: default # Bisa dihilangkan jika Anda menggunakan namespace default
  annotations:
    # Annotation untuk Ingress Nginx Controller
    nginx.ingress.kubernetes.io/proxy-body-size: "0" # Mengizinkan ukuran request body tidak terbatas
    nginx.ingress.kubernetes.io/ssl-redirect: "false" # Matikan redirect HTTPS jika tidak pakai SSL (penting untuk Minikube)
    # Jika endpoint Spring Boot Anda TIDAK memiliki /api di dalamnya (misal: /auth/register),
    # dan Anda ingin Ingress menghapus /api dari path sebelum meneruskan ke backend,
    # maka Anda perlu annotation ini:
    # nginx.ingress.kubernetes.io/rewrite-target: /$2
spec:
  rules:
    - host: localhost # Ganti dengan domain Anda jika ada
      http:
        paths:
          # Aturan untuk API backend
          # Semua request yang dimulai dengan /api akan diteruskan ke backend-service
          # Jika Spring Boot Anda endpointnya /api/auth/register, maka ini sudah benar.
          # Jika endpointnya /auth/register, Anda perlu rewrite-target di atas.
    # - http:
    #     paths:
          # Aturan untuk API backend
          # Semua request yang dimulai dengan /api akan diteruskan ke backend-service
          # Jika Spring Boot Anda endpointnya /api/auth/register, maka ini sudah benar.
          # Jika endpointnya /auth/register, Anda perlu rewrite-target di atas.
        # - path: /api
        - path: /api # Akan cocok dengan /api, /api/, /api/auth, /api/users, dll.
          pathType: Prefix # Akan cocok dengan /api, /api/auth, /api/users, dll.
          backend:
            service:
              name: backend-service # Nama Service Kubernetes untuk backend Anda
              port:
                number: 8081 # Port yang diekspos oleh Service backend (sesuai server.port di Spring Boot)

          # Aturan untuk frontend (catch-all untuk semua path lainnya)
          # Semua request yang tidak cocok dengan /api akan diteruskan ke frontend-service
        - path: /
          pathType: Prefix # Akan cocok dengan semua path
          backend:
            service:
              name: frontend-service # Nama Service Kubernetes untuk frontend Anda
              port:
                number: 80 # Port yang diekspos oleh Service frontend (Nginx di kontainer frontend)